# MoonBattery IoT/Backend
Implementation for the API of the MoonBattery IoT/Backend

## Agenda
- A summary about the development tools like language, framework and libraries.
- A list of all the assumptions I made while developing the API.
- Instructions for how to run the App locally.
- A list of stuff I wish I could do, but did not due to the lack of time.
1. About the development tools:
    - Ruby version ruby 3.2.2
    - Ruby On Rails 7.1.5
    - PostgreSQL Database
    - RSpec for testing
    - FactoryBot and Faker for creating factories
    - Pundit for Authorization Handling
2. A list of all the assumptions I made
    - I am using Ruby On Rails and my api is implemented following the convetion of the RESTful structure.
    - I am following the TDD principle in allover the app.
    - The only available piece of info during registration is the MAC address of the battery.
    - The battery is manufactured and has never been saved on the backend.
    - The backend will save the MoonBattery record and will generate the serial_number.
    - The serial number will not be used by human.I mean it's format does not need to be tidy.Just a unique string for the battery.
    - The battery will receive the serial number and the serial number will be used instead of autogenerated id primary key to access battery resources.
    - I know from my past experience with embedded systems that firmware updates may lead to adding new configuation or multiple of them or even remove some.So, I am expecting that the configurations if saved to a separate table will not have a fixed schema, so I decdided to add them in the format of key-value pairs like:
      ```
      { config_name: 'setting1', config_value: 'value1' }
      ```
      This will provide the flexibility and resiliency to host more batteries with different types and different versions.
    - I am using token based authentication mechanism for handling the authentication between the backend and the battery.
    - There are several approches for authentication.I chose the most suitable for the task.
      - When registering the battery, the backend will create the auth_token, a unique one and indexd ofcourse and saved to the battery record.
      - After registration, the backend will return the serial_number and the auth_token only.
      - The battery is responsible for saving that token and providing it as an Authorization header in every request.
      - The backend will talk once and only once with any battery having a mac_address during registration and next calls from the battery having that mac_address have to be authenticated.
      - Each battery will be able to access its resources only as long as it is authenticated and will not be able to access other batteries due to the implemented authorization.That type of requests will be :forbidden.

3. How to run the app
    - For the full API documentation, please visit the [API Documentation](https://ahmadbakry11.github.io/moon_battery_iot_api/).
    - Make sure you have Ruby and Ruby On Rails +5 installed.
    - Make sure that your Ruby version is compatible with your Rails version.
    - Make sure you have postgresql installed.
    - For Postgres database credentials, please add them to Env variables.
       - From your terminal run:
         ```
         export PG_USER='your postgres username'
         export PG_PASSWORD='your postgres password'
         ```
       - For linux load those env variables
         ```
          source ~/.bashrc
         ```
         or open your .bash_profile to load them in mac.
      - After cloning the App Repo.
      - ```
          cd moon_battery_iot_backend
        ```
      - ```
         bundle
        ```
      - To run the app
        ```
          rails server
        ```
      - To run tests
        ```
         rspec
        ```
4. List of Stuff, I wish I could make:
   
   - I did not have time to integrate CI/CD tool to my app.
   - Api versioning.
